{% extends 'change/provision.html' %}

{% block title %}Provisioning - Logs{% endblock %}

{% block content %}
    <div id="terminal_output"></div>
{% endblock %}

{% block javascript %}
    <script type="application/javascript">
    var term = new Terminal();
    term.open(document.getElementById('terminal_output'));

    websocket = new WebSocket((location.protocol.startsWith('https') ? 'wss' : 'ws') + '://' + location.host + '/change/provisions/{{ provision_set.pk }}/logs/ws/');
    websocket.onmessage = (msg) => {
        var data = JSON.parse(msg.data);
        if (data.scope === 'stdout') {
            term.write(data.line.replace('\n', '\r\n'));
        }
        console.log(data);
    }
    </script>
{% endblock %}