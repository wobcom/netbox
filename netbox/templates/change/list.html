{% extends '_base.html' %}
{% load helpers %}

{% block header %}
{% endblock %}

{% block title %}
  {% if changeset %}
    Changeset {{ changeset.pk }} created!
  {% else %}
    Nothing to do!
  {% endif %}
{% endblock %}

{% block content %}
<div class="row">
  <div class="col-md-3"></div>
  <div class="col-md-6">
    {% if changeset != None %}
      <h3>Changeset {{ changeset.pk }} ({{ changeset.change_information.name }}) created!</h3>
      <p>
        We’ve recorded these changes since you started this changeset. Please
        make sure that those changes are correct and then click the “Submit”
        button below!
      </p>
      <h4>Change Description</h4>
      {% if changeset.change_information.is_emergency %}
        <b>Emergency Change</b>
      {% endif %}
      <h5>What changes if the change is accepted?</h5>
        {{ changeset.change_information.change_implications }}
      <h5>What changes if the change is rejected?</h5>
        {{ changeset.change_information.ignore_implications }}

      <h5>Change Category</h5>
        <table class="table">
          <thead class="thead-light">
            <tr>
              <th>Type</th>
              <th>Category</th>
              <th>Subcategory</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>{{ changeset.change_information.get_change_type_display }}</td>
              <td>{{ changeset.change_information.get_category_display }}</td>
              <td>{{ changeset.change_information.get_subcategory_display }}</td>
            </tr>
          </tbody>
        </table>

      {% if changeset.change_information.affects_customer %}
        <h6>Who is affected?</h6>
        <ul>
        {% for customer in changeset.change_information.affectedcustomer_set.all %}
          <li>{{ customer.name }}{% if customer.is_business %} (Business Customer){% endif %}: {{ customer.products_affected }}</li>
        {% endfor %}
        </ul>
      {% endif %}
      <h4>Change List</h4>
      <h5>Changed Fields</h5>
      {% if changeset.changedfield.set.exists %}
        <ol>
          {% for change in changeset.changedfield_set.all %}
            <li>{{change}}</li>
          {% endfor %}
        </ol>
      {% else %}
        <p>No changes</p>
      {% endif %}
      <h5>Changed Objects</h5>
      {% if changeset.changedobject.set.exists %}
        <ol>
          {% for change in changeset.changedobject_set.all %}
            <li>{{change}}</li>
          {% endfor %}
        </ol>
      {% else %}
        <p>No changes</p>
      {% endif %}
      <div class="pull-right">
        <a href="/change/{{changeset.pk}}/accept/" class="btn btn-primary" id="change-accept">
          Accept
        </a>
        <a href="/change/{{changeset.pk}}/reject/" class="btn btn-default">
          Reject
        </a>
      </div>
    {% else %}
      <h3>Nothing to do!</h3>
      <p>We didn’t detect any changes in this set.</p>
    {% endif %}
  </div>
</div>

<script>
window.onload = () => {
  $('#change-accept').click(() => {
    let e = document.createElement("div");
    e.classList.add('loader');
    document.body.appendChild(e);
  });
};
</script>

<style>
.loader {
  border: 2vw solid #f3f3f3; /* Light grey */
  border-top: 2vw solid #3498db; /* Blue */
  border-radius: 50%;
  width: 10vw;
  height: 10vw;
  animation: spin 2s linear infinite;
  position: absolute;
  top: 40vh;
  left: 45vw;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>
{% endblock %}
